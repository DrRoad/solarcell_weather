geom_smooth(se=FALSE, method="lm", formula = y ~ sin(2*pi/per*x)+cos(2*pi/per*x)+sin(4*pi/per*x)+cos(4*pi/per*x))
solarcell_tbl <- summarySE(solarcell_tbl, measurevar="Produktion", groupvars=c("YEAR","MONTH"))
ggplot(data = solarcell_tbl, aes(x = MONTH, y = Produktion )) +
geom_bar(position=position_dodge(), stat="identity") +
facet_wrap(~YEAR) +
geom_errorbar(aes(ymin=Produktion-se, ymax=Produktion+se),
width=.2,                    # Width of the error bars
position=position_dodge(.9))
ggplot(data = solarcell_tbl, aes(x = MONTH, y = Produktion, fill = YEAR )) +
geom_bar(position=position_dodge(), stat="identity")
ggplot(data = solarcell_tbl, aes(x = MONTH, y = Produktion )) +
geom_bar(position="dodge")
ggplot(data = solarcell_tbl, aes(x = MONTH, y = Produktion )) +
geom_bar(position="dodge", stat="identity")
ggplot(data = solarcell_tbl, aes(x = MONTH, y = Produktion )) +
geom_bar(aes(fill=YEAR), position="dodge", stat="identity")
ggplot(data = solarcell_tbl, aes(x = MONTH, y = Produktion )) +
geom_bar(aes(fill=YEAR), position="dodge", stat="identity") +
facet_wrap(~YEAR) +
geom_errorbar(aes(ymin=Produktion-se, ymax=Produktion+se),
width=.2,                    # Width of the error bars
position=position_dodge(.9))
ggplot(data = solarcell_tbl, aes(x = MONTH, y = Produktion )) +
geom_bar(aes(fill=YEAR), position=position_dodge(.9), stat="identity") +
facet_wrap(~YEAR) +
geom_errorbar(aes(ymin=Produktion-se, ymax=Produktion+se),
width=.2,                    # Width of the error bars
position=position_dodge(.9))
#3 tidyverse
solarcell_tbl %>% group_by(YEAR, MONTH) %>% summarise()
#3 tidyverse
solarcell_tbl %>% group_by(YEAR, MONTH) %>% summarise(Produktion)
solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(Produktion) %>%
ggplot(., aes(Produktion)) + geom_bar()
solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(Produktion) %>%
ggplot(., aes(Produktion)) + geom_bar(stat = "identity")
solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(Produktion) %>%
ggplot(., aes(Produktion)) + geom_line()
solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(Produktion) %>%
ggplot(., aes(Produktion)) + geom_bar()
solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(Produktion) %>%
ggplot(., aes(Produktion)) + geom_bar(stat = "identity")
solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(Produktion) %>%
ggplot(., aes(.)) + geom_bar(stat = "identity")
#3 tidyverse
solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(Produktion) %>%
ggplot(., ) + geom_bar(stat = "identity")
solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(Produktion) %>%
ggplot(., ) + geom_bar(stat = "identity")
tt <- solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise()
tt <- solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(Produktion)
ggplot(tt, aes(Produktion)) + geom_bar(stat = "identity")
ggplot(tt, aes(tt$Produktion)) + geom_bar(stat = "identity")
str(tt)
tt$Produktion
ggplot(tt, aes(tt$Produktion)) + geom_bar(stat = "identity")
tt$P <- solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(Produktion)
ggplot(tt, aes(P)) + geom_bar(stat = "identity")
x <-1:72
ggplot(tt, aes(x=x, y=P)) + geom_bar(stat = "identity")
ggplot(tt, aes(x=x, y=P)) + geom_bar(stat = "identity", width = 0.5)
x <-1:nrow(tt)
ggplot(tt, aes(x=x, y=P)) + geom_bar(stat = "identity", width = 0.5)
library(readr)
library(dplyr)
library(ggplot2)
library(lubridate)
source(summary_se.R)
dir_name = "solarzellen_data"
solarcell_files_names = list.files(path = dir_name, pattern="/*.csv")
solarcell_files_names<- paste(dir_name, solarcell_files_names, sep = "/")
solarcell_tbl <- data_frame("datum"=character(0), "zaehlerstand_morgens"= numeric(0), "zaehlerstand_abends" = numeric(0),"produktion"= numeric(0),"eigen_verbrauch"= numeric(0),"eingespeist"= numeric(0))
solarcell_tbl = lapply(solarcell_files_names, read_csv2) %>% bind_rows()
#using lubridate to make the Datum column more usefull
solarcell_tbl$Datum <- dmy(solarcell_tbl$Datum)
ggplot(solarcell_tbl, aes(x = Datum, y = Produktion)) +
geom_point(size=2, shape=23) +
geom_smooth(linetype="dashed")
ggplot(data = solarcell_tbl, aes(x = Datum, y = Produktion)) +
geom_point() +
geom_smooth(se=FALSE, method="lm", formula = y ~ sin(2*pi/per*x)+cos(2*pi/per*x))
#including second harmonic
ggplot(data = solarcell_tbl, aes(x = Datum, y = Produktion)) +
geom_point() +
geom_smooth(se=FALSE, method="lm", formula = y ~ sin(2*pi/per*x)+cos(2*pi/per*x)+sin(4*pi/per*x)+cos(4*pi/per*x))
#manage the dates
solarcell_tbl$YEAR <- year(solarcell_tbl$Datum)
solarcell_tbl$MONTH <- month(solarcell_tbl$Datum)
solarcell_tbl$DAY <- day(solarcell_tbl$Datum)
ggplot(data = solarcell_tbl, aes(x = MONTH, y = Produktion )) +
geom_point() +
facet_wrap(~YEAR) +
geom_smooth(se=FALSE, method="lm", formula = y ~ sin(2*pi/per*x)+cos(2*pi/per*x)+sin(4*pi/per*x)+cos(4*pi/per*x))
solarcell_tbl <- summarySE(solarcell_tbl, measurevar="Produktion", groupvars=c("YEAR","MONTH"))
ggplot(data = solarcell_tbl, aes(x = MONTH, y = Produktion )) +
geom_bar(aes(fill=YEAR), position=position_dodge(.9), stat="identity") +
facet_wrap(~YEAR) +
geom_errorbar(aes(ymin=Produktion-se, ymax=Produktion+se),
width=.2,                    # Width of the error bars
position=position_dodge(.9))
# monthly plot
solar_monthly$P <- solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(Produktion)
x <-1:nrow(solar_monthly)
ggplot(solar_monthly, aes(x=x, y=P)) + geom_bar(stat = "identity", width = 0.5)
solar_monthly %>% funs(mean, sd)
solar_monthly$P <- solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(Produktion)
solar_monthly$P <- solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(P)
solarcell_tbl %>%
group_by(YEAR, MONTH)
solar_monthly$P <- solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(solar_monthly$P)
solar_monthly$P <- solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(solarcell_tbl$Produktion)
solarcell_tbl %>%
group_by(YEAR, MONTH)
y <- solarcell_tbl$Produktion
t <- 1:2167
x <- solarcell_tbl$Datum
solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(solarcell_tbl$Produktion)
solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(solarcell_tbl$Produktion)
ggplot(solarcell_tbl, aes(x = Datum, y = Produktion)) +
geom_point(size=2, shape=23) +
geom_smooth(linetype="dashed")
ggplot(data = solarcell_tbl, aes(x = Datum, y = Produktion)) +
geom_point() +
geom_smooth(se=FALSE, method="lm", formula = y ~ sin(2*pi/per*x)+cos(2*pi/per*x))
ggplot(data = solarcell_tbl, aes(x = Datum, y = Produktion)) +
geom_point() +
geom_smooth(se=FALSE, method="lm", formula = y ~ sin(2*pi/per*x)+cos(2*pi/per*x)+sin(4*pi/per*x)+cos(4*pi/per*x))
tt$P <- solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(Produktion)
solarcell_tbl <- summarySE(solarcell_tbl, measurevar="Produktion", groupvars=c("YEAR","MONTH"))
source(summary_se.R)
source("summary_se.R")
#load solarzellen data
library(readr)
library(dplyr)
library(ggplot2)
library(lubridate)
source("summary_se.R")
dir_name = "solarzellen_data"
solarcell_files_names = list.files(path = dir_name, pattern="/*.csv")
solarcell_files_names<- paste(dir_name, solarcell_files_names, sep = "/")
solarcell_tbl <- data_frame("datum"=character(0), "zaehlerstand_morgens"= numeric(0), "zaehlerstand_abends" = numeric(0),"produktion"= numeric(0),"eigen_verbrauch"= numeric(0),"eingespeist"= numeric(0))
solarcell_tbl = lapply(solarcell_files_names, read_csv2) %>% bind_rows()
#using lubridate to make the Datum column more usefull
solarcell_tbl$Datum <- dmy(solarcell_tbl$Datum)
solarcell_tbl <- summarySE(solarcell_tbl, measurevar="Produktion", groupvars=c("YEAR","MONTH"))
ggplot(solarcell_tbl, aes(x = Datum, y = Produktion)) +
geom_point(size=2, shape=23) +
geom_smooth(linetype="dashed")
ggplot(data = solarcell_tbl, aes(x = Datum, y = Produktion)) +
geom_point() +
geom_smooth(se=FALSE, method="lm", formula = y ~ sin(2*pi/per*x)+cos(2*pi/per*x))
#including second harmonic
ggplot(data = solarcell_tbl, aes(x = Datum, y = Produktion)) +
geom_point() +
geom_smooth(se=FALSE, method="lm", formula = y ~ sin(2*pi/per*x)+cos(2*pi/per*x)+sin(4*pi/per*x)+cos(4*pi/per*x))
#manage the dates
solarcell_tbl$YEAR <- year(solarcell_tbl$Datum)
solarcell_tbl$MONTH <- month(solarcell_tbl$Datum)
solarcell_tbl$DAY <- day(solarcell_tbl$Datum)
ggplot(data = solarcell_tbl, aes(x = MONTH, y = Produktion )) +
geom_point() +
facet_wrap(~YEAR) +
geom_smooth(se=FALSE, method="lm", formula = y ~ sin(2*pi/per*x)+cos(2*pi/per*x)+sin(4*pi/per*x)+cos(4*pi/per*x))
solarcell_tbl <- summarySE(solarcell_tbl, measurevar="Produktion", groupvars=c("YEAR","MONTH"))
ssp <- spectrum(y)
per <- 1/ssp$freq[ssp$spec==max(ssp$spec)]
reslm <- lm(y ~ sin(2*pi/per*t)+cos(2*pi/per*t))
summary(reslm)
rg <- diff(range(y))
plot(y~t,ylim=c(min(y)-0.1*rg,max(y)+0.1*rg))
lines(fitted(reslm)~t,col=4,lty=1)   # dashed blue line is sin fit
# including 2nd harmonic really improves the fit
reslm2 <- lm(y ~ sin(2*pi/per*t)+cos(2*pi/per*t)+sin(4*pi/per*t)+cos(4*pi/per*t))
summary(reslm2)
lines(fitted(reslm2)~t,col=3)
#2 fft
raw.fft = fft(y)
y <- solarcell_tbl$Produktion
t <- 1:2167
x <- solarcell_tbl$Datum
# sinus fit
#1
ssp <- spectrum(y)
per <- 1/ssp$freq[ssp$spec==max(ssp$spec)]
reslm <- lm(y ~ sin(2*pi/per*t)+cos(2*pi/per*t))
summary(reslm)
rg <- diff(range(y))
plot(y~t,ylim=c(min(y)-0.1*rg,max(y)+0.1*rg))
lines(fitted(reslm)~t,col=4,lty=1)   # dashed blue line is sin fit
# including 2nd harmonic really improves the fit
reslm2 <- lm(y ~ sin(2*pi/per*t)+cos(2*pi/per*t)+sin(4*pi/per*t)+cos(4*pi/per*t))
summary(reslm2)
lines(fitted(reslm2)~t,col=3)
#2 fft
raw.fft = fft(y)
ggplot(solarcell_tbl, aes(x = Datum, y = Produktion)) +
geom_point(size=2, shape=23) +
geom_smooth(linetype="dashed")
ggplot(data = solarcell_tbl, aes(x = Datum, y = Produktion)) +
geom_point() +
geom_smooth(se=FALSE, method="lm", formula = y ~ sin(2*pi/per*x)+cos(2*pi/per*x))
#including second harmonic
ggplot(data = solarcell_tbl, aes(x = Datum, y = Produktion)) +
geom_point() +
geom_smooth(se=FALSE, method="lm", formula = y ~ sin(2*pi/per*x)+cos(2*pi/per*x)+sin(4*pi/per*x)+cos(4*pi/per*x))
#manage the dates
solarcell_tbl$YEAR <- year(solarcell_tbl$Datum)
solarcell_tbl$MONTH <- month(solarcell_tbl$Datum)
solarcell_tbl$DAY <- day(solarcell_tbl$Datum)
ggplot(data = solarcell_tbl, aes(x = MONTH, y = Produktion )) +
geom_point() +
facet_wrap(~YEAR) +
geom_smooth(se=FALSE, method="lm", formula = y ~ sin(2*pi/per*x)+cos(2*pi/per*x)+sin(4*pi/per*x)+cos(4*pi/per*x))
ggplot(data = solarcell_tbl, aes(x = MONTH, y = Produktion )) +
geom_bar(aes(fill=YEAR), position=position_dodge(.9), stat="identity") +
facet_wrap(~YEAR) +
geom_errorbar(aes(ymin=Produktion-se, ymax=Produktion+se),
width=.2,                    # Width of the error bars
position=position_dodge(.9))
solar_monthly$P <- solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(solarcell_tbl$Produktion)
tt <- solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(Produktion)
solar_monthly <- solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(solarcell_tbl$Produktion)
x <-1:nrow(solar_monthly)
ggplot(solar_monthly, aes(x=x, y=P)) + geom_bar(stat = "identity", width = 0.5)
solar_monthly %>% funs(mean, sd)
ggplot(solar_monthly, aes(x=x, y=P)) + geom_bar(stat = "identity", width = 0.5)
ggplot(solar_monthly, aes(x=x, y=solar_monthly$Produktion)) + geom_bar(stat = "identity", width = 0.5)
xxd <- ata.frame(P=as.numeric)
xx <- data.frame(P=as.numeric)
xx$P <- solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(solarcell_tbl$Produktion)
solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(solarcell_tbl$Produktion)
solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(solarcell_tbl$Produktion) %>% nrow()
nr <- solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(solarcell_tbl$Produktion) %>% nrow()
xx <- data.frame(matrix(NA, nrow = nr, ncol = 1))
xx$P <- solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(solarcell_tbl$Produktion)
nr <- solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(solarcell_tbl$Produktion) %>% nrow()
solar_monthly <- data.frame(matrix(NA, nrow = nr, ncol = 1))
solar_monthly$P <- solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(solarcell_tbl$Produktion)
x <-1:nrow(solar_monthly)
ggplot(solar_monthly, aes(x=x, y=solar_monthly$Produktion)) + geom_bar(stat = "identity", width = 0.5)
solar_monthly %>% funs(mean, sd)
solar_monthly <- data.frame(matrix(NA, nrow = nr, ncol = 1))
solar_monthly <- solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(solarcell_tbl$Produktion)
solar_monthly <- data.frame(matrix(NA, nrow = nr, ncol = 1))
solar_monthly <- solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(Produktion)
solar_monthly <- data.frame(matrix(NA, nrow = nr, ncol = 1))
solar_monthly$P <- solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(Produktion)
solar_monthly <- data.frame(matrix(NA, nrow = nr, ncol = 1))
solar_monthly <- solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(Produktion)
x <-1:nrow(solar_monthly)
ggplot(solar_monthly, aes(x=x, y=solar_monthly$Produktion)) + geom_bar(stat = "identity", width = 0.5)
solar_monthly %>% funs(mean, sd)
solar_monthly$Produktion %>% funs(mean, sd)
solar_monthly %>% summarise(Produktio, funs(mean, sd))
solar_monthly %>% summarise(Produktion, funs(mean, sd))
solar_monthly %>% summarise(solar_monthly$Produktion, funs(mean, sd))
solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise(Produktion, funs(mean,sd))
solarcell_tbl %>%
group_by(YEAR, MONTH) %>%
summarise_at(vars(Produktion), funs(mean,sd))
solarcell_tbl %>%
group_by( MONTH) %>%
summarise_at(vars(Produktion), funs(mean,sd))
solarcell_tbl %>%
group_by(YEAR) %>%
summarise_at(vars(Produktion), funs(mean,sd))
source("solar_auswertung.R")
sapply(solarcell_tbl$Produktion, wetter)
solarcell_tbl$rating <- sapply(solarcell_tbl$Produktion, wetter)
View(tt)
tttf <- function(data, varname) {
return('$'(data, varname))
}
tttf(tt, "Produktion")
`$`(tt, "Produktion")
tttf <- function(data, varname) {
return(`$`(data, varname))
}
tttf(tt, "Produktion")
tttf <- function(data, varname) {
zz <- `$`(data, varname)
return(zz)
}
tttf(tt, "Produktion")
tttf <- function(data, varname) {
zz <- `$`(data, varname)
print(zz)
return(zz)
}
tttf(tt, "Produktion")
tttf <- function(data, varname) {
print(varname)
zz <- `$`(data, varname)
print(zz)
return(zz)
}
tttf(tt, "Produktion")
tttf <- function(data, varname) {
print(varname)
zz <- `$`(data, as.character(varname))
print(zz)
return(zz)
}
tttf(tt, "Produktion")
tttf <- function(data, varname) {
print(varname)
zz <- `$`(data, as.character(varname[1]))
print(zz)
return(zz)
}
tttf(tt, "Produktion")
tttf <- function(data, varname) {
print(varname)
zz <- `$`(data, varname[1])
print(zz)
return(zz)
}
tttf(tt, "Produktion")
tttf <- function(data, varname) {
return(data[varname])
}
tttf(tt, "Produktion")
tttf <- function(data, varname) {
return(`$`(data, as.name))
}
tttf(tt, "Produktion")
tttf <- function(data, varname) {
return(`$`(data, as.name(varname)))
}
tttf(tt, "Produktion")
tttf(tt, 'Produktion')
tttf <- function(data, varname) {
return(`$`(data, varname))
}
tttf(tt, 'Produktion')
tt
View(solarcell_tbl)
tttf(solarcell_tbl, 'Produktion')
tttf <- function(data, varname) {
return(`$`(data, as.name(varname)))
}
tttf(solarcell_tbl, 'Produktion')
tttf <- function(data, varname) {
return(data[varname])
}
tttf(solarcell_tbl, 'Produktion')
`$`(tt, "Produktion")
tttf(solarcell_tbl, 'Produktion')
tttf2 <- function(data, varname) {
return(`$`(tt, as.name(vorname[1])))
}
tttf2(solarcell_tbl, 'Produktion')
tttf2 <- function(data, varname) {
return(`$`(tt, vorname[1]))
}
tttf2(solarcell_tbl, 'Produktion')
tttf2 <- function(data, varname) {
return(`$`(tt, vorname[[1]]))
}
tttf2(solarcell_tbl, 'Produktion')
tttf2 <- function(data, varname) {
return(`$`(tt, as.name(vorname[[1]])))
}
tttf2(solarcell_tbl, 'Produktion')
#load solarzellen data
library(readr)
library(dplyr)
library(ggplot2)
library(lubridate)
source("summary_se.R")
source("solar_auswertung.R")
dir_name = "solarzellen_data"
solarcell_files_names = list.files(path = dir_name, pattern="/*.csv")
solarcell_files_names<- paste(dir_name, solarcell_files_names, sep = "/")
solarcell_tbl <- data_frame("datum"=character(0), "zaehlerstand_morgens"= numeric(0), "zaehlerstand_abends" = numeric(0),"produktion"= numeric(0),"eigen_verbrauch"= numeric(0),"eingespeist"= numeric(0))
solarcell_tbl = lapply(solarcell_files_names, read_csv2) %>% bind_rows()
#using lubridate to make the Datum column more usefull
solarcell_tbl$Datum <- dmy(solarcell_tbl$Datum)
solarcell_tbl <- summarySE(solarcell_tbl, measurevar="Produktion", groupvars=c("YEAR","MONTH"))
solarcell_tbl$rating <- sapply(solarcell_tbl$Produktion, wetter)
y <- solarcell_tbl$Produktion
t <- 1:2167
x <- solarcell_tbl$Datum
# sinus fit
#1
ssp <- spectrum(y)
per <- 1/ssp$freq[ssp$spec==max(ssp$spec)]
reslm <- lm(y ~ sin(2*pi/per*t)+cos(2*pi/per*t))
summary(reslm)
rg <- diff(range(y))
plot(y~t,ylim=c(min(y)-0.1*rg,max(y)+0.1*rg))
lines(fitted(reslm)~t,col=4,lty=1)   # dashed blue line is sin fit
# including 2nd harmonic really improves the fit
reslm2 <- lm(y ~ sin(2*pi/per*t)+cos(2*pi/per*t)+sin(4*pi/per*t)+cos(4*pi/per*t))
summary(reslm2)
lines(fitted(reslm2)~t,col=3)
#2 fft
raw.fft = fft(y)
ggplot(solarcell_tbl, aes(x = Datum, y = Produktion)) +
geom_point(size=2, shape=23) +
geom_smooth(linetype="dashed")
ggplot(data = solarcell_tbl, aes(x = Datum, y = Produktion)) +
geom_point() +
geom_smooth(se=FALSE, method="lm", formula = y ~ sin(2*pi/per*x)+cos(2*pi/per*x))
#load solarzellen data
library(readr)
library(dplyr)
library(ggplot2)
library(lubridate)
source("summary_se.R")
source("solar_auswertung.R")
dir_name = "solarzellen_data"
solarcell_files_names = list.files(path = dir_name, pattern="/*.csv")
solarcell_files_names<- paste(dir_name, solarcell_files_names, sep = "/")
solarcell_tbl <- data_frame("datum"=character(0), "zaehlerstand_morgens"= numeric(0), "zaehlerstand_abends" = numeric(0),"produktion"= numeric(0),"eigen_verbrauch"= numeric(0),"eingespeist"= numeric(0))
solarcell_tbl = lapply(solarcell_files_names, read_csv2) %>% bind_rows()
#using lubridate to make the Datum column more usefull
solarcell_tbl$Datum <- dmy(solarcell_tbl$Datum)
solarcell_tbl <- summarySE(solarcell_tbl, measurevar="Produktion", groupvars=c("YEAR","MONTH"))
solarcell_tbl$rating <- sapply(solarcell_tbl$Produktion, wetter)
y <- solarcell_tbl$Produktion
t <- 1:2167
x <- solarcell_tbl$Datum
# sinus fit
#1
ssp <- spectrum(y)
per <- 1/ssp$freq[ssp$spec==max(ssp$spec)]
reslm <- lm(y ~ sin(2*pi/per*t)+cos(2*pi/per*t))
summary(reslm)
rg <- diff(range(y))
plot(y~t,ylim=c(min(y)-0.1*rg,max(y)+0.1*rg))
lines(fitted(reslm)~t,col=4,lty=1)   # dashed blue line is sin fit
# including 2nd harmonic really improves the fit
reslm2 <- lm(y ~ sin(2*pi/per*t)+cos(2*pi/per*t)+sin(4*pi/per*t)+cos(4*pi/per*t))
summary(reslm2)
lines(fitted(reslm2)~t,col=3)
#2 fft
raw.fft = fft(y)
ggplot(solarcell_tbl, aes(x = Datum, y = Produktion)) +
geom_point(size=2, shape=23) +
geom_smooth(linetype="dashed")
ggplot(data = solarcell_tbl, aes(x = Datum, y = Produktion)) +
geom_point() +
geom_smooth(se=FALSE, method="lm", formula = y ~ sin(2*pi/per*x)+cos(2*pi/per*x))
